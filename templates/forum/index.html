{% extends "base.html" %}
{% load static %}
{% load humanize %}

{% block title %}–ì–æ–ª–æ–≤–Ω–∞ ‚Äî –ë–æ—á–∫–∞–ú–µ–¥—É{% endblock %}

{% block content %}
<div class="row gx-4">
  <!-- main -->
  <div class="col-lg-8">
    <!-- Hero / Search -->
    <div class="card mb-4 fade-in neon-hover">
      <div class="card-body">
        <h1 class="card-title">–í—ñ—Ç–∞–Ω–Ω—è –Ω–∞ –Ω–∞ —Ñ–æ—Ä—É–º—ñ –ë–æ—á–∫–∞–ú–µ–¥—É üëã</h1>
        <!-- –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π —Ç–µ–∫—Å—Ç –ø—Ä–æ —Ñ–æ—Ä—É–º -->
        <p class="mb-2">
          –ë–æ—á–∫–∞–ú–µ–¥—É ‚Äî —Ü–µ –¥—Ä—É–∂–Ω—ñ–π —Ñ–æ—Ä—É–º –¥–ª—è –æ–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è –≤—ñ–¥–µ–æ—ñ–≥–æ—Ä, —Å—Ç—Ä—ñ–º—ñ–≤, —ñ–Ω–¥—ñ-–ø—Ä–æ—î–∫—Ç—ñ–≤ —ñ –≤—Å—å–æ–≥–æ, —â–æ –∑ –Ω–∏–º–∏ –ø–æ–≤'—è–∑–∞–Ω–æ.
          –î—ñ–ª–∏—Å—è –≤—Ä–∞–∂–µ–Ω–Ω—è–º–∏, —Å—Ç–∞–≤ –ø–∏—Ç–∞–Ω–Ω—è —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞–º, –∑–Ω–∞–π–æ–º—Å—è –∑ —ñ–Ω—à–∏–º–∏ –≥—Ä–∞–≤—Ü—è–º–∏, –æ–±–≥–æ–≤–æ—Ä—é–π —Ç–∞–∫—Ç–∏–∫–∏ —Ç–∞ –Ω–æ–≤–∏–Ω–∏ —ñ–≥–æ—Ä.
        </p>
        {% comment %} <p class="text-muted">–ú–∞–ª–µ –º—ñ—Å—Ü–µ –¥–ª—è –≤–µ–ª–∏–∫–æ—ó —Ä–æ–∑–º–æ–≤–∏ ‚Äî –æ–±–∏—Ä–∞–π –∫–∞—Ç–µ–≥–æ—Ä—ñ—é –∞–±–æ —Å—Ç–≤–æ—Ä–∏ —Ç–µ–º—É.</p> {% endcomment %}

        <div class="mb-3 align-items-center">
          <p>–û—Å—Ç–∞–Ω–Ω—î –≤—ñ–¥–µ–æ –Ω–∞ –∫–∞–Ω–∞–ª—ñ OldBoi</p>
          <iframe width="100%" height="315" src="https://www.youtube.com/embed/EymCLJrr7w4?si=0KTUsFegt7LeZ2Js" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
        </div>

        <div class="mt-3">
          {% if user.is_authenticated %}
            <a href="{% url 'new_thread' %}" class="btn btn-primary">–°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–µ–º—É</a>
          {% else %}
            <a href="{% url 'login' %}?next={% url 'new_thread' %}" class="btn btn-outline-primary">–£–≤—ñ–π—Ç–∏, —â–æ–± —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–µ–º—É</a>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Popular topics -->
    <div class="mb-4">
      <h4 class="mb-3">–ü–æ–ø—É–ª—è—Ä–Ω—ñ —Ç–µ–º–∏</h4>

      <div class="list-group">
        {% for t in popular_threads %}
          <div class="list-group-item d-flex justify-content-between align-items-start topic-item mb-2 fade-in neon-hover">
            <div class="ms-2 me-auto">
              <div class="fw-bold">
                <a href="{{ t.get_absolute_url }}" class="stretched-link text-decoration-none">{{ t.title }}</a>
              </div>
              <div class="small text-muted">
                –ö–∞—Ç–µ–≥–æ—Ä—ñ—è: <a href="{{ t.category.get_absolute_url }}">{{ t.category.title }}</a>
                ‚Ä¢ –∞–≤—Ç–æ—Ä: {{ t.author.username }}
                ‚Ä¢ {{ t.updated_at|naturaltime }}
              </div>
            </div>
            <div class="text-end small">
              <div>üí¨ {{ t.posts_count }}</div>
              <div>üëÄ {{ t.views }}</div>
            </div>
          </div>
        {% empty %}
          <div class="text-muted">–ü–æ–ø—É–ª—è—Ä–Ω–∏—Ö —Ç–µ–º —â–µ –Ω–µ–º–∞—î.</div>
        {% endfor %}
      </div>
    </div>

    <!-- Recent activity / recent posts -->
    <div class="mb-4">
      <h5 class="mb-3">–û—Å—Ç–∞–Ω–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</h5>

      {% for p in recent_posts %}
        <div class="card mb-2 fade-in neon-hover">
          <div class="card-body">
            <div class="d-flex align-items-start gap-3">
              {% if p.author.profile.avatar %}
                <img src="{{ p.author.profile.avatar.url }}" alt="avatar" class="rounded-circle" width="48" height="48">
              {% else %}
                <img src="{% static 'img/avatar-placeholder.png' %}" alt="avatar" class="rounded-circle" width="48" height="48">
              {% endif %}
              <div>
                <div class="fw-bold">{{ p.author.username }} <span class="small text-muted">‚Ä¢ {{ p.created_at|naturaltime }}</span></div>
                <div class="mt-1">–í —Ç–µ–º—ñ <a href="{{ p.thread.get_absolute_url }}">{{ p.thread.title }}</a></div>
                <div class="text-truncate small text-muted mt-1">{{ p.content|striptags|truncatechars:140 }}</div>
              </div>
            </div>
          </div>
        </div>
      {% empty %}
        <div class="card mb-2">
          <div class="card-body text-muted">–ü–æ—Å—Ç—ñ–≤ —â–µ –Ω–µ–º–∞—î.</div>
        </div>
      {% endfor %}
    </div>

    <!-- All threads (main feed) -->
    <div class="mb-4">
      <h5 class="mb-3">–£—Å—ñ —Ç–µ–º–∏</h5>

      <div class="list-group">
        {% for t in threads %}
          <div class="list-group-item d-flex justify-content-between align-items-start mb-2 fade-in neon-hover">
            <div class="ms-2 me-auto">
              <div class="fw-bold">
                <a href="{{ t.get_absolute_url }}" class="stretched-link text-decoration-none">{{ t.title }}</a>
              </div>
              <div class="small text-muted">
                –ö–∞—Ç–µ–≥–æ—Ä—ñ—è: <a href="{{ t.category.get_absolute_url }}">{{ t.category.title }}</a>
                ‚Ä¢ {{ t.author.username }}
                ‚Ä¢ {{ t.updated_at|naturaltime }}
              </div>
            </div>
            <div class="text-end small">
              <div>üí¨ {{ t.posts_count }}</div>
              <div>üëÄ {{ t.views }}</div>
            </div>
          </div>
        {% endfor %}
      </div>


      <nav aria-label="threads pagination" class="mt-3">
        <ul class="pagination">
          {% if threads.has_previous %}
            <li class="page-item"><a class="page-link" href="?page={{ threads.previous_page_number }}">‚Üê</a></li>
          {% endif %}
          <li class="page-item disabled"><span class="page-link">–°—Ç–æ—Ä—ñ–Ω–∫–∞ {{ threads.number }} –∑ {{ threads.paginator.num_pages }}</span></li>
          {% if threads.has_next %}
            <li class="page-item"><a class="page-link" href="?page={{ threads.next_page_number }}">‚Üí</a></li>
          {% endif %}
        </ul>
      </nav>
    </div>

  </div>

  <!-- sidebar -->
  <aside class="col-lg-4">
    <!-- Categories widget -->
    <div class="card mb-3 fade-in neon-hover">
      <div class="card-header">
        –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó
      </div>
      <ul class="list-group list-group-flush">
        {% for c in categories %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <a href="{{ c.get_absolute_url }}">{{ c.title }}</a>
            <span class="small text-muted"> {{ c.threads_count }} —Ç–µ–º</span>
          </li>
        {% empty %}
          <li class="list-group-item text-muted">–ö–∞—Ç–µ–≥–æ—Ä—ñ–π –Ω–µ–º–∞—î.</li>
        {% endfor %}
      </ul>
    </div>

    <!-- mini author card -->
    <div class="card mb-3 text-center fade-in neon-hover">
      <div class="card-body">
        {% if user.is_authenticated %}
          {% if user.profile.avatar %}
            <img src="{{ user.profile.avatar.url }}" class="rounded-circle mb-2" width="80" height="80" alt="avatar">
          {% else %}
            <img src="{% static 'img/avatar-placeholder.png' %}" class="rounded-circle mb-2" width="80" height="80" alt="avatar">
          {% endif %}
          <h6 class="card-title mb-0">{{ user.get_full_name|default:user.username }}</h6>
          <p class="text-muted small mb-2">@{{ user.username }}</p>
          <a href="{% url 'profile' %}" class="btn btn-outline-primary btn-sm">–ü–µ—Ä–µ–π—Ç–∏ —É –ø—Ä–æ—Ñ—ñ–ª—å</a>
        {% else %}
          <img src="{% static 'img/avatar-placeholder.png' %}" class="rounded-circle mb-2" width="80" height="80" alt="avatar">
          <h6 class="card-title mb-0">–ì—ñ—Å—Ç—å</h6>
          <p class="text-muted small mb-2">–£–≤—ñ–π–¥–∏ –∞–±–æ –∑–∞—Ä–µ—î—Å—Ç—Ä—É–π—Å—è</p>
          <a href="{% url 'login' %}" class="btn btn-outline-primary btn-sm mb">–£–≤—ñ–π—Ç–∏</a>
          <a href="{% url 'register' %}" class="btn btn-primary btn-sm">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</a>
        {% endif %}
      </div>
    </div>

    <!-- Users online widget -->
    <div class="card mb-3 fade-in neon-hover">
      <div class="card-body">
        <h6>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –æ–Ω–ª–∞–π–Ω <span class="small text-muted">({{ users_online_count }})</span></h6>
        {% if users_online_count > 0 %}
          <ul class="list-unstyled mb-0">
            {% for u in users_online %}
              <li class="d-flex align-items-center py-1">
                {% if u.profile.avatar %}
                  <img src="{{ u.profile.avatar.url }}" alt="avatar" width="36" height="36" class="rounded-circle me-2">
                {% else %}
                  <img src="{% static 'img/avatar-placeholder.png' %}" alt="avatar" width="36" height="36" class="rounded-circle me-2">
                {% endif %}
                <div>
                  <div class="small fw-bold">{{ u.get_full_name|default:u.username }}</div>
                  <div class="small text-muted">{{ u.username }} ‚Ä¢ {{ u.last_login|naturaltime }}</div>
                </div>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <div class="small text-muted">–ù–∞—Ä–∞–∑—ñ –Ω—ñ–∫–æ–≥–æ –Ω–µ–º–∞—î –æ–Ω–ª–∞–π–Ω (–∑–∞ last_login).</div>
        {% endif %}
      </div>
    </div>

    <!-- event timer -->
    <div class="card mb-3 fade-in neon-hover">
      <div class="card-body">
        <h6>üéÑ –¢–∞–π–º–µ—Ä –¥–æ –ù–æ–≤–æ–≥–æ –†–æ–∫—É üéÑ</h6>
        <div id="countdown" class="h5">00:00:00</div>
      </div>
    </div>
    
    <div class="card mb-3 fade-in neon-hover">
      <div class="card-body">
        <p>–ü—Ä–∏—î–¥–Ω—É–π—Å—è –¥–æ –Ω–∞—à–æ–≥–æ –î–∏—Å–∫–æ—Ä–¥ —Å–µ—Ä–≤–µ—Ä–∞!</p>
        <iframe src="https://discord.com/widget?id=804856048757899284&theme=dark" width="100%" height="500" allowtransparency="true" allowtransparency="true" frameborder="0" sandbox="allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts"></iframe>
      </div>
    </div>


    
  </aside>
</div>
{% endblock %}
