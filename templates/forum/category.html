{% extends "base.html" %}
{% load static humanize %}

{% block title %}{{ category.title|default:"–ö–∞—Ç–µ–≥–æ—Ä—ñ—è" }} ‚Äî –ë–æ—á–∫–∞–ú–µ–¥—É{% endblock %}

{% block content %}
<div class="row gx-4">
  <div class="col-lg-8">
    <!-- Breadcrumb / Title -->
    <nav aria-label="breadcrumb" class="mb-3">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'index' %}">–ì–æ–ª–æ–≤–Ω–∞</a></li>
        <li class="breadcrumb-item active" aria-current="page">
            {{ category.title|default:"–†–æ–∑–¥—ñ–ª" }}
        </li>
      </ol>
    </nav>

    <div class="d-flex justify-content-between align-items-start mb-3">
      <div>
        <h1 class="h3 mb-1">{{ category.title|default:"–†–æ–∑–¥—ñ–ª: –†–æ–∑—Ä–æ–±–∫–∞" }}</h1>
        <p class="text-muted mb-0">{{ category.description|default:"–û–ø–∏—Å –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –≤—ñ–¥—Å—É—Ç–Ω—ñ–π." }}</p>
      </div>
      <div class="text-end">
        <a href="{% url 'new_thread' %}" class="btn btn-primary">–ù–æ–≤–∞ —Ç–µ–º–∞</a>
      </div>
    </div>

    <!-- Threads list -->
    <div class="list-group">
      {% if threads %}
        {% for t in threads %}
          {# use non-anchor container + stretched-link to avoid nested anchors #}
          <div class="list-group-item list-group-item-action mb-2 shadow-sm fade-in neon-hover position-relative card-level-1">
            {# stretched link for whole-item clickability #}
            {% comment %} <a href="{{ t.get_absolute_url }}" class="stretched-link">—Ñ—Ñ—Ñ—Ñ</a> {% endcomment %}

            <div class="d-flex w-100 justify-content-between align-items-start">
              <div class="me-3">
                <a href="{{ t.get_absolute_url }}" class="stretched-link"><div class="fw-bold h6 mb-1">{{ t.title }}</div></a>
                
                <div class="small text-muted">
                  –ê–≤—Ç–æ—Ä:
                  {% if t.author and t.author.username %}
                    <a href="{% url 'profile_view' t.author.username %}">{{ t.author.get_full_name|default:t.author.username }}</a>
                  {% elif t.author %}
                    {{ t.author.get_full_name|default:"–ù–µ–≤—ñ–¥–æ–º–∏–π" }}
                  {% else %}
                    <span class="text-muted">–ê–Ω–æ–Ω—ñ–º</span>
                  {% endif %}
                  ‚Ä¢ {{ t.updated_at|naturaltime }}
                </div>
              </div>

              <div class="text-end small">
                <div>üí¨ {{ t.posts_count }}</div>
                <div>üëÄ {{ t.views }}</div>
              </div>
            </div>

            <div class="mt-2 d-flex justify-content-between small text-muted">
              <div>
                {% with last_post=t.last_post %}
                  {% if last_post %}
                    –û—Å—Ç–∞–Ω–Ω—ñ–π –ø–æ—Å—Ç: <a href="{{ t.get_absolute_url }}#post-{{ last_post.pk }}">{{ last_post.author.get_full_name|default:last_post.author.username }}</a>
                    ‚Ä¢ {{ last_post.created_at|naturaltime }}
                  {% else %}
                    –ù–µ–º–∞—î –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π
                  {% endif %}
                {% endwith %}
              </div>

              <div>
                {% if t.pinned %}<span class="badge bg-warning text-dark me-1">Pinned</span>{% endif %}
                {% if t.closed %}<span class="badge bg-secondary">Closed</span>{% endif %}
              </div>
            </div>
          </div>
        {% endfor %}

        <!-- pagination -->
        <nav aria-label="threads pagination" class="mt-3">
          <ul class="pagination justify-content-center">
            {% if threads.has_previous %}
              <li class="page-item">
                <a class="page-link" href="?page={{ threads.previous_page_number }}" aria-label="previous">&larr;</a>
              </li>
            {% endif %}
            <li class="page-item disabled"><span class="page-link">–°—Ç–æ—Ä—ñ–Ω–∫–∞ {{ threads.number }} –∑ {{ threads.paginator.num_pages }}</span></li>
            {% if threads.has_next %}
              <li class="page-item">
                <a class="page-link" href="?page={{ threads.next_page_number }}" aria-label="next">&rarr;</a>
              </li>
            {% endif %}
          </ul>
        </nav>

      {% else %}
        <div class="card mb-3">
          <div class="card-body text-muted">–£ —Ü—ñ–π –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó —â–µ –Ω–µ–º–∞—î —Ç–µ–º.</div>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- Sidebar -->
  <aside class="col-lg-4">
    <div class="card mb-3 shadow-sm fade-in card-level-1">
      <div class="card-header">–®–≤–∏–¥–∫—ñ –¥—ñ—ó</div>
      <div class="card-body">
        <a href="{% url 'new_thread' %}" class="btn btn-primary w-100 mb-2">–°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–µ–º—É</a>
        {% comment %} {% if categories|length > 0 %}
          <a href="{{ categories.0.get_absolute_url }}" class="btn btn-outline-primary w-100 mb-2">–Ü–Ω—à—ñ —Ç–µ–º–∏ ‚Äî {{ categories.0.title }}</a>
        {% else %}
          <a href="{% url 'categories' %}" class="btn btn-outline-primary w-100 mb-2">–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó</a>
        {% endif %} {% endcomment %}
        <a href="{% url 'categories' %}" class="btn btn-outline-primary w-100">–í—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</a>
      </div>
    </div>

    <div class="card mb-3 shadow-sm fade-in card-level-1">
      <div class="card-header">–¢–æ–ø-—É—á–∞—Å–Ω–∏–∫–∏</div>
      <ul class="list-group list-group-flush">
        {% for u in top_users %}
          <li class="list-group-item small d-flex justify-content-between align-items-center">
            <div>
              <strong>{{ u.get_full_name|default:u.username }}</strong>
              <div class="small text-muted">@{{ u.username }}</div>
            </div>
            <span class="text-muted small">{{ u.posts_count }}</span>
          </li>
        {% empty %}
          <li class="list-group-item small text-muted">–ù–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–∏—Ö —É—á–∞—Å–Ω–∏–∫—ñ–≤.</li>
        {% endfor %}
      </ul>
    </div>

    <div class="card mb-3 shadow-sm fade-in card-level-1">
      <div class="card-body">
        <h6>–í—ñ–¥–∂–µ—Ç: –ö–æ—Ä–æ—Ç–∫—ñ –ø–æ—Ä–∞–¥–∏</h6>
        <p class="small text-muted">–ü–∏—à–∏ —á—ñ—Ç–∫–æ, –¥–æ–¥–∞–≤–∞–π –ø—Ä–∏–∫–ª–∞–¥–∏ —ñ –ø–µ—Ä–µ–≤—ñ—Ä—è–π –∫–æ–¥ –ø–µ—Ä–µ–¥ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—î—é.</p>
      </div>
    </div>
  </aside>
</div>
{% endblock %}
