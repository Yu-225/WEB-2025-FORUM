{% extends "base.html" %}
{% load static %}
{% load humanize %} 

{% block title %}Профіль — {{ profile_user.username }} — БочкаМеду{% endblock %}

{% block content %}
<div class="row gx-4">
  <!-- main content: posts -->
  <div class="col-lg-8">
    <div class="card mb-3 shadow-sm fade-in">
      <div class="card-body d-flex gap-3">
        <div>
          {% if profile_user.profile.avatar %}
            <img src="{{ profile_user.profile.avatar.url }}" alt="avatar" class="rounded-circle" width="96" height="96">
          {% else %}
            <img src="{% static 'img/avatar-placeholder.png' %}" alt="avatar" class="rounded-circle" width="96" height="96">
          {% endif %}
        </div>

        <div class="w-100">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <h4 class="mb-0">{{ profile_user.get_full_name|default:profile_user.username }}</h4>
              <div class="small text-muted">@{{ profile_user.username }}</div>
            </div>
            <div class="text-end">
              {% if is_owner %}
                <a href="{% url 'profile_edit' %}" class="btn btn-sm btn-outline-primary">Редагувати профіль</a>
              {% else %}
                <button class="btn btn-sm btn-outline-primary">Підписатися</button>
              {% endif %}
            </div>
          </div>

          <p class="mt-2 mb-1">{{ profile_user.profile.bio|default:"Користувач нічого не написав про себе." }}</p>
          <div class="small text-muted">
            Приєднався: {{ profile_user.date_joined|date:"Y-m-d H:i" }} •
            {{ profile_user.profile.location|default:"—" }} •
            {% if profile_user.profile.website %}
              <a href="{{ profile_user.profile.website }}" target="_blank" rel="noopener">{{ profile_user.profile.website }}</a>
            {% else %}
              —
            {% endif %}
          </div>

          <div class="mt-3">
            <span class="me-3"><strong>{{ posts_count }}</strong> пости</span>
            <span class="me-3"><strong>{{ threads_count }}</strong> теми</span>
          </div>
        </div>
      </div>
    </div>

    <!-- User posts -->
    <h5 class="mb-3">Останні пости</h5>

    <div id="user-posts" class="mb-3">
      {% for p in posts %}
        <div class="card mb-3 shadow-sm fade-in">
          <div class="card-body">
            <a href="{{ p.thread.get_absolute_url }}" class="h6">{{ p.thread.title }}</a>
            <div class="small text-muted mb-2">{{ p.created_at|naturaltime }}</div>
            <p class="mb-0 text-truncate">{{ p.content|striptags|truncatechars:200 }}</p>
            <div class="mt-2 small text-muted">Переглянути тему: <a href="{{ p.thread.get_absolute_url }}">{{ p.thread.title }}</a></div>
          </div>
        </div>
      {% empty %}
        <div class="card mb-3">
          <div class="card-body text-muted">Користувач ще не написав постів.</div>
        </div>
      {% endfor %}
    </div>
  </div>

  <!-- sidebar: додаткова інформація -->
  <aside class="col-lg-4 fade-in">
    <div class="card mb-3 shadow-sm">
      <div class="card-header">Деталі користувача</div>
      <ul class="list-group list-group-flush">
        <li class="list-group-item"><strong>Логін:</strong> {{ profile_user.username }}</li>
        <li class="list-group-item"><strong>Приєднався:</strong> {{ profile_user.date_joined|date:"Y-m-d" }}</li>
        <li class="list-group-item"><strong>Локація:</strong> {{ profile_user.profile.location|default:"—" }}</li>
        <li class="list-group-item"><strong>Сайт:</strong>
          {% if profile_user.profile.website %}
            <a href="{{ profile_user.profile.website }}" target="_blank" rel="noopener">{{ profile_user.profile.website }}</a>
          {% else %}
            —
          {% endif %}
        </li>
      </ul>
    </div>

    <div class="card mb-3 shadow-sm">
      <div class="card-body">
        <h6>Статистика</h6>
        <div class="small text-muted">Пости: <strong>{{ posts_count }}</strong></div>
        <div class="small text-muted">Теми: <strong>{{ threads_count }}</strong></div>
      </div>
    </div>

  </aside>
</div>
{% endblock %}
