{% extends "base.html" %}
{% load static %}

{% block title %}Редагувати пост — БочкаМеду{% endblock %}

{% block content %}
<link href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css" rel="stylesheet">

<div class="row gx-4">
  <div class="col-lg-8">
    <div class="card mb-4">
      <div class="card-body">
        <h4 class="card-title mb-3">Редагувати пост</h4>

        <form method="post" id="edit-post-form" novalidate>
          {% csrf_token %}
          {{ form.non_field_errors }}

          <!-- Quill toolbar -->
          <div id="quill-toolbar" class="mb-2">
            <span class="ql-formats">
              <select class="ql-header"><option selected></option><option value="2">H2</option></select>
              <button class="ql-bold"></button>
              <button class="ql-italic"></button>
              <button class="ql-underline"></button>
              <button class="ql-list" value="ordered"></button>
              <button class="ql-list" value="bullet"></button>
              <button class="ql-blockquote"></button>
              <button class="ql-link"></button>
            </span>
          </div>

          <div id="quill-editor" class="card card-level-2 mb-2" style="min-height:200px;padding:.75rem;"></div>

          <!-- hidden textarea must match form field name -->
          <textarea name="{{ form.content.html_name }}" id="id_content" hidden>{{ form.content.value|default_if_none:"" }}</textarea>
          {% if form.content.errors %}
            <div class="invalid-feedback d-block">{{ form.content.errors.0 }}</div>
          {% endif %}

          <div class="d-flex gap-2">
            <button class="btn btn-primary" type="submit">Зберегти</button>
            <a class="btn btn-outline-secondary" href="{{ post.thread.get_absolute_url }}">Назад</a>
          </div>
        </form>

      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
  const quill = new Quill('#quill-editor', {
    modules: { toolbar: '#quill-toolbar' },
    theme: 'snow'
  });

  const hidden = document.getElementById('id_content');
  if (hidden && hidden.value.trim().length > 0) {
    try { quill.clipboard.dangerouslyPasteHTML(hidden.value); } catch(e){ console.warn(e); }
  }

  const form = document.getElementById('edit-post-form');
  form.addEventListener('submit', function (e) {
    hidden.value = quill.root.innerHTML;
    return true;
  });
});
</script>

<style>
/* невеликі стилі, як у new_thread */
.ql-toolbar.ql-snow { background: var(--card-bg-level-2); border: 1px solid var(--bs-border-color); }
.ql-container.ql-snow { border: 1px solid var(--bs-border-color); background: var(--card-bg-level-1); }
</style>
{% endblock %}
